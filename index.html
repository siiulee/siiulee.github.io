<!DOCTYPE html>
<html>

    <head>
        <link rel="manifest" href="manifest.json" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Moon Garden</title>
        <meta charset="UTF-8">
        <style>

            * {
                box-sizing: border-box;
            }

            html, body {
                background:black;
                color:white;
                font-family: sans-serif;
                min-height:100vh;
                -webkit-font-smoothing:antialiased;
                min-width:100vw;
                min-height:100vh;
                /* overflow:hidden; */
                margin:0;
                -webkit-text-size-adjust: 100%;
            }

            .container {
                display:flex;
                padding:100px 10% 100px;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height:100vh;
                max-width:800px;
                min-height: -webkit-fill-available;
                margin:0 auto;
                gap:20px;
            }

            .scroller {
                display: flex;
                flex-wrap: nowrap;
                white-space: nowrap;
                font-size:15px;
            }

            .scroller span {
                display:block;
                animation: scroll 10s linear infinite;
            }

            @keyframes scroll {
                0% {
                    transform:translateX(0%)
                }
                100% {
                    transform:translateX(-100%)
                }
            }

            .top {
                position:fixed;
                top:0;
                padding:30px 0;
            }

            .bottom {
                position:fixed;
                bottom:0;
                padding:30px 0;
            }

            .btn, button, label {
                padding:20px 10px;
                border-radius: 10px;
                background:#3426f5;
                width:100%;
                text-align: center;
                color:black;
                font-weight: bold;
                -webkit-appearence:none;
                outline:none;
                border:0;
                text-transform: uppercase;
                min-width:200px;
                font-size:16px;
            }

            .img-wrapper {
                width:80vw !important;
                height:80vw !important;
                max-width:400px !important;
                max-height:400px !important;
                border-radius: 1000px;
                background-image: url(fam.jpg);
                background:cover;
                aspect-ratio: 1 / 1;
                background-position: center;
            }

            ::backdrop {
                background:#000;
                opacity: 0.75;
            }

            .hide {
                display:none;
            }

            canvas {
                width:80vw !important;
                height:80vw !important;
                max-width:400px !important;
                max-height:400px !important;
            }

            input[type="file"] {
                display: none;
            }
            label {
                display: inline-block;
                cursor: pointer;
            }

            dialog {
                outline:none;
                border:0;
                border-radius:5px;
                
            }

            .close, .skip, .links button {
              
                margin-top:20px;
                background:transparent;
                text-decoration: underline;
                padding:0;
                color:#333;
                text-transform: none;
                font-weight:normal
            }

            .skip, .links button, .page4 p {
                color:#3426f5;
            }

            .links {
                display:flex;
                justify-content:space-between;
            }

            .page3 img {
                width:100%;
            }

            .page5 p, .page5 a {
                margin: 0;
                color:#3426f5;
            }

            .page5 {
                align-items: start;
            }

            .back1, .back2 {
                position:fixed;
                top:20px;
                left:20px;
                width:30px;
                height:30px
            }

            .back1 svg, .back2 svg {
                width:100%;
            }

        </style>

    </head>
    <body>
        <div id="p5_loading"></div>
        <div class="scroller top">
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>MOON GARDEN /////// DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
        </div>

        <div class="container page1">


            <div class="img-wrapper"></div>
        
        
            <div class="btn">DROP OFF</div>


        </div>

        <div class="container page2 hide">
            <div id="cnv"></div>
            <div id="savebtn"></div>
            <button class="skip">Skip</button>
        </div>

        <div class="container page3 hide">
            <img src="the-rug-.jpg">
            <div class="links">
                <button class="description">Description</button>
                <button class="contact">Contact</button>
            </div>
        </div>

        <div class="container page4 hide">
            <div class="back1">
                <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 47.75 47.75">
                    <defs>
                        <style>
                        .cls-1 {
                            fill: none;
                            stroke: #3426f5;
                            stroke-miterlimit: 10;
                            stroke-width: 3;
                        }
                        </style>
                    </defs>
                    <circle class="cls-1" cx="23.87" cy="23.87" r="23.37"/>
                    <line class="cls-1" x1="7.35" y1="7.35" x2="40.4" y2="40.4"/>
                    <line class="cls-1" x1="40.37" y1="7.38" x2="7.38" y2="40.37"/>
                </svg>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi sollicitudin fringilla nisi ut vulputate. Nullam non odio at felis lobortis congue. In fermentum ornare arcu, et laoreet magna accumsan in. Integer eget feugiat augue. Fusce pretium suscipit suscipit. Vivamus interdum gravida ipsum, eu placerat neque tempus a. Vivamus id erat at ligula pellentesque consectetur quis eget lorem. Nam faucibus condimentum metus, vel vulputate ipsum congue ac.</p>
        </div>

        <div class="container page5 hide">
            <div class="back2">
                <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 47.75 47.75">
                    <defs>
                        <style>
                        .cls-1 {
                            fill: none;
                            stroke: #3426f5;
                            stroke-miterlimit: 10;
                            stroke-width: 3;
                        }
                        </style>
                    </defs>
                    <circle class="cls-1" cx="23.87" cy="23.87" r="23.37"/>
                    <line class="cls-1" x1="7.35" y1="7.35" x2="40.4" y2="40.4"/>
                    <line class="cls-1" x1="40.37" y1="7.38" x2="7.38" y2="40.37"/>
                </svg>
            </div>
            <p>Name: Siiu Lee</p>
            <p>Phone: <a href="tel:+447440423140">+44 7440 423 140</a></p>
            <p>Instagram: <a href="http://instagram.com/0.3.00.am" target="_blank">@0.3.00.am</a></p>
            <p>Email: <a href="mailto:slee023@campus.goldsmiths.ac.uk" target="_blank">slee023@campus.goldsmiths.ac.uk</a></p>
        </div>

        <div class="scroller bottom">
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
            <span>DROP OFF WHAT YOU WANT TO PRESERVE ON THE MOON GARDEN //////&nbsp;</span>
        </div>

        <dialog>
            <div class="dialog-inner">
                
                <form id="form">
                </form>
                <button autofocus class="close">Cancel</button>
            </div>
        </dialog>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js" integrity="sha512-d6sc8kbZEtA2LwB9m/ck0FhvyUwVfdmvTeyJRprmj7Wg9wRFtHDIpr6qk4g/y3Ix3O9I6KHIv6SGu9f7RaP1Gw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>

            const dialog = document.querySelector("dialog");
            const showButton = document.querySelector(".btn");
            const closeButton = document.querySelector("dialog button");
            const skipButton = document.querySelector(".skip");
            const descriptionButton = document.querySelector(".description");
            const contactButton = document.querySelector(".contact");
            const p1 = document.querySelector('.page1')
            const p2 = document.querySelector('.page2')
            const p3 = document.querySelector('.page3')
            const p4 = document.querySelector('.page4')
            const p5 = document.querySelector('.page5')
            const _top = document.querySelector('.top')
            const _bottom = document.querySelector('.bottom')
            const backButton1 = document.querySelector('.back1')
            const backButton2 = document.querySelector('.back2')

            // "Show the dialog" button opens the dialog modally
            showButton.addEventListener("click", () => {
                dialog.showModal();
            });

            // "Close" button closes the dialog
            closeButton.addEventListener("click", () => {
                dialog.close();
            });

            skipButton.addEventListener("click", () => {
                p2.classList.add('hide')
                p3.classList.remove('hide')
            });

            descriptionButton.addEventListener("click", () => {
                p3.classList.add('hide')
                p4.classList.remove('hide')
            });

            contactButton.addEventListener("click", () => {
                p3.classList.add('hide')
                p5.classList.remove('hide')
            });

            backButton1.addEventListener("click", () => {
                p4.classList.add('hide')
                p5.classList.add('hide')
                p3.classList.remove('hide')
            });
            backButton2.addEventListener("click", () => {
                p4.classList.add('hide')
                p5.classList.add('hide')
                p3.classList.remove('hide')
            });

            let img;
            let w,h
            let bk
            let shadow
            let overlay

            function preload() {
                bk = loadImage('111.webp')
                shadow = loadImage('shadow2.png')
                overlay = loadImage('overlay.png')
            }

            function setup() {
                let cnv = createCanvas(400,400)
                cnv.parent('cnv')
                input = createFileInput(handleFile);
                input.parent('form')
                input.id('file-upload')
                input.attribute("accept","image/*")
                input.attribute("name","file")
                let label = createElement('label', 'Choose Image');
                label.parent('form')
                label.attribute('for', 'file-upload')
                imageMode(CENTER)
                rectMode(CENTER)
                let button = createButton('Save');
                button.parent('savebtn')
                button.mousePressed(makeImage);
            }

            function draw() {
                image(bk, width/2,height/2,width, height)
                if (img) {
                    push()
                    translate(width/4+20, height/4+10)
                    rotate(0.3)
                    image(shadow,-1,7, w+15,h+7);
                    rotate(-0.1)
                    shearX(-0.1);
                    image(img, 0,0, w,h);
                    image(overlay, 0,0, w,h);
                    // filter(GRAY)
                    pop()
                }
            }

            const form = document.getElementById('form')
            const url = 'https://samtripp.com/moon/upload2.php'

            function handleFile(file) {
                if (file.type === 'image') {
                    img = createImg(file.data, '', true, function() {
                        let r =  img.height/img.width
                        w = 120;
                        h = w*r;
                        dialog.close();
                        p1.classList.add('hide')
                        p2.classList.remove('hide')
                        imageResize(img)
                    });
                    img.hide();
                    _top.style.display = 'none'
                    _bottom.style.display = 'none'
                } else {
                    img = null;
                }
            }

            function imageResize(img) {
                let r =  img.height/img.width
                let w2 = 200;
                let h2 = w2*r;
                let tmp = createGraphics(w2,h2)
                tmp.image(img, 0,0, w2, h2)
                // saveCanvas(tmp);
                tmp.loadPixels();
                let b64 =  tmp.canvas.toDataURL();
                var xhr = new XMLHttpRequest();
                xhr.withCredentials = false;
                xhr.addEventListener('readystatechange', function() {
                    if (this.readyState === 4) {
                        console.log(this.responseText)
                        var data = JSON.parse(this.responseText);
                        console.log(data);
                    } else {
                        console.log(this)
                    }
                });
               
                var method = 'POST';
                xhr.open(method, url);
                xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhr.send('img='+encodeURIComponent(b64));
            }   

            function makeImage() {
                // var xhr = new XMLHttpRequest();
                // xhr.withCredentials = false;
                // xhr.addEventListener('readystatechange', function() {
                //     if (this.readyState === 4) {
                //         console.log(this.responseText)
                //         var data = JSON.parse(this.responseText);
                //         console.log(data);
                //     } else {
                //         console.log(this)
                //     }
                // });
                // var data = new FormData(form)
                // console.log(data)
                // var method = 'POST';
                // xhr.open(method, url);
                // xhr.setRequestHeader("Accept", "application/json");
                // xhr.send(data);
                
                saveCanvas();
            }

        </script>
    </body>
</html>